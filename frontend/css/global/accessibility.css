/**
 * ===== ECOLIFE ACCESSIBILITY STYLES =====
 * WCAG 2.1 Compliant Accessibility Improvements
 * 
 * Issue #565: Dark Mode and Accessibility Improvements
 * 
 * Features:
 * - Skip links for keyboard navigation
 * - Focus visible states for all interactive elements
 * - Screen reader only utilities
 * - High contrast mode support
 * - Reduced motion support
 * - Focus trap utilities
 * - Touch target sizing (minimum 44x44px)
 */

/* ===== SCREEN READER ONLY UTILITY ===== */
.sr-only,
.visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/* Show when focused (for skip links) */
.sr-only-focusable:focus,
.sr-only-focusable:active {
    position: static !important;
    width: auto !important;
    height: auto !important;
    padding: inherit !important;
    margin: inherit !important;
    overflow: visible !important;
    clip: auto !important;
    white-space: normal !important;
}

/* ===== SKIP NAVIGATION LINK ===== */
.skip-link {
    position: absolute;
    top: -100%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10001;
    padding: 16px 32px;
    background: var(--primary-color, #2e7d32);
    color: #ffffff !important;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 0 0 var(--radius-md, 12px) var(--radius-md, 12px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    transition: top 0.3s ease;
}

.skip-link:focus {
    top: 0;
    outline: 3px solid #ffffff;
    outline-offset: 2px;
}

/* ===== FOCUS VISIBLE STATES ===== */
/* Global focus visible for keyboard users */
*:focus-visible {
    outline: 3px solid var(--primary-color, #2e7d32);
    outline-offset: 3px;
}

/* Remove default outline for mouse users */
*:focus:not(:focus-visible) {
    outline: none;
}

/* Enhanced focus for interactive elements */
a:focus-visible,
button:focus-visible,
[role="button"]:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
    outline: 3px solid var(--primary-color, #2e7d32);
    outline-offset: 3px;
    border-radius: var(--radius-sm, 8px);
}

/* Dark mode focus adjustments */
[data-theme="dark"] *:focus-visible {
    outline-color: var(--primary-color, #4ade80);
}

/* Custom focus ring for buttons */
.btn:focus-visible,
.card-btn:focus-visible,
.nav-link:focus-visible {
    outline: 3px solid var(--primary-color, #2e7d32);
    outline-offset: 4px;
    box-shadow: 0 0 0 6px rgba(46, 125, 50, 0.2);
}

[data-theme="dark"] .btn:focus-visible,
[data-theme="dark"] .card-btn:focus-visible,
[data-theme="dark"] .nav-link:focus-visible {
    box-shadow: 0 0 0 6px rgba(74, 222, 128, 0.3);
}

/* Theme toggle button focus */
.theme-toggle-btn:focus-visible,
#themeToggle:focus-visible {
    outline: 3px solid #ffffff;
    outline-offset: 3px;
    border-radius: var(--radius-md, 12px);
}

/* ===== MINIMUM TOUCH TARGET SIZE (44x44px WCAG) ===== */
button,
[role="button"],
.btn,
.nav-link,
.card-btn,
.theme-toggle-btn,
input[type="checkbox"],
input[type="radio"] {
    min-height: 44px;
    min-width: 44px;
}

/* Small inline links can be smaller but need adequate padding */
a:not(.btn):not(.card-btn) {
    padding: 2px 4px;
    margin: -2px -4px;
}

/* ===== THEME TRANSITION STYLES ===== */
.theme-transitioning,
.theme-transitioning *,
.theme-transitioning *::before,
.theme-transitioning *::after {
    transition:
        background-color 0.4s ease,
        border-color 0.4s ease,
        color 0.4s ease,
        fill 0.4s ease,
        box-shadow 0.4s ease !important;
}

/* ===== REDUCED MOTION SUPPORT ===== */
@media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    .theme-transitioning,
    .theme-transitioning * {
        transition: none !important;
    }

    /* Disable parallax and floating effects */
    .floating-element,
    .particle,
    .cloud,
    .leaves-layer,
    .birds-layer {
        animation: none !important;
        transform: none !important;
    }
}

/* ===== HIGH CONTRAST MODE SUPPORT ===== */
@media (prefers-contrast: high) {
    :root {
        --primary-color: #006400;
        --text-primary: #000000;
        --bg-primary: #ffffff;
        --border-color: #000000;
    }

    [data-theme="dark"] {
        --primary-color: #90ee90;
        --text-primary: #ffffff;
        --bg-primary: #000000;
        --border-color: #ffffff;
    }

    /* Stronger focus indicators */
    *:focus-visible {
        outline: 4px solid currentColor !important;
        outline-offset: 2px !important;
    }

    /* High contrast buttons */
    .btn-primary {
        background: var(--primary-color) !important;
        border: 3px solid currentColor !important;
    }

    /* Ensure link visibility */
    a {
        text-decoration: underline !important;
    }
}

/* ===== FORCED COLORS MODE (Windows High Contrast) ===== */
@media (forced-colors: active) {

    .btn,
    button {
        border: 2px solid currentColor;
    }

    .theme-toggle-btn,
    #themeToggle {
        border: 2px solid currentColor;
    }

    /* Ensure icons are visible */
    .theme-toggle-btn i,
    #themeToggle i {
        forced-color-adjust: none;
    }
}

/* ===== FORM ACCESSIBILITY ===== */
/* Required field indicator */
label.required::after,
.form-label.required::after {
    content: " *";
    color: #dc2626;
    font-weight: bold;
}

[data-theme="dark"] label.required::after,
[data-theme="dark"] .form-label.required::after {
    color: #f87171;
}

/* Error state */
.form-error,
.input-error {
    border-color: #dc2626 !important;
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2) !important;
}

/* Error message */
.error-message {
    color: #dc2626;
    font-size: 0.875rem;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
}

[data-theme="dark"] .error-message {
    color: #f87171;
}

.error-message::before {
    content: "⚠";
}

/* ===== LINK ACCESSIBILITY ===== */
/* Ensure links are distinguishable */
article a,
.content a,
p a {
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
}

article a:hover,
.content a:hover,
p a:hover {
    text-decoration-thickness: 3px;
}

/* External link indicator */
a[target="_blank"]::after {
    content: " ↗";
    font-size: 0.8em;
    vertical-align: super;
}

/* ===== IMAGE ACCESSIBILITY ===== */
/* Ensure images have visible alt text indicators when alt is missing */
img:not([alt]),
img[alt=""] {
    outline: 3px dashed #dc2626;
}

/* ===== LOADING STATES ACCESSIBILITY ===== */
.loading,
[aria-busy="true"] {
    cursor: wait;
}

.loading::after {
    content: "";
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner 0.75s linear infinite;
    margin-left: 8px;
    vertical-align: middle;
}

@keyframes spinner {
    to {
        transform: rotate(360deg);
    }
}

@media (prefers-reduced-motion: reduce) {
    .loading::after {
        animation: none;
        border-right-color: currentColor;
    }
}

/* ===== DISABLED STATE ACCESSIBILITY ===== */
[disabled],
.disabled,
[aria-disabled="true"] {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
}

/* ===== MODAL/DIALOG ACCESSIBILITY ===== */
/* Focus trap styling - hide background content from assistive tech */
.modal-open,
[aria-modal="true"]~* {
    visibility: hidden;
    pointer-events: none;
}

/* Modal focus outline */
.modal:focus,
[role="dialog"]:focus {
    outline: none;
}

/* ===== LIVE REGION FOR ANNOUNCEMENTS ===== */
#theme-announcer,
.live-region,
[role="status"],
[role="alert"] {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Visible alerts */
.alert-visible[role="alert"] {
    position: relative;
    width: auto;
    height: auto;
    padding: 16px 20px;
    margin: 16px 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
    background: var(--bg-card);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--primary-color);
}

/* ===== PRINT STYLES FOR ACCESSIBILITY ===== */
@media print {

    .skip-link,
    .theme-toggle-btn,
    #themeToggle,
    .back-to-top {
        display: none !important;
    }

    a[href^="http"]::after {
        content: " (" attr(href) ")";
        font-size: 0.8em;
    }
}