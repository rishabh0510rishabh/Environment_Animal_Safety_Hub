<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eco Memory Match</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../../css/pages/games/memory-card-game.css">
<link rel="stylesheet" href="../../css/global/utilities.css" />
  <link rel="stylesheet" href="../../css/components/footer.css" />
  <link rel="stylesheet" href="../../css/components/navbar.css" />
</head>

<body>

  <div id="cursor-container"></div>
<script src="../../js/components/loadComponents.js"></script>


  <div id="navbar-container"></div>

<header>
  <h1>ğŸ§  Eco Memory Match</h1>
  <p>Memorize eco-friendly cards, match pairs, and win within time ğŸŒ±</p>
</header>

<div class="container" id="mainContent">

  <!-- HOW TO PLAY -->
  <div class="how-to-play">
    <h2>ğŸ“˜ How to Play</h2>
    <ul>
      <li>Click Start Game</li>
      <li>Get Ready popup appears</li>
      <li>Cards open for 6 seconds</li>
      <li>Cards hide automatically</li>
      <li>You get 40 seconds</li>
      <li>Match all cards to win ğŸ‰</li>
    </ul>
  </div>

  <!-- GAME -->
  <div class="game-area">
    <div class="game-top">
      <div>â± Time: <span id="time">40</span>s</div>
      <div>Moves: <span id="moves">0</span></div>
    </div>

    <div class="grid" id="grid"></div>
    <div class="status-text" id="status"></div>

    <div class="btn-group">
      <button class="btn" id="startBtn">â–¶ Start Game</button>
      <button class="btn secondary" onclick="location.href='kids-quiz-dashboard.html'">
        ğŸ  Go to Dashboard
      </button>
    </div>
  </div>

</div>

<!-- POPUP -->
<div class="overlay" id="overlay">
  <div class="popup" id="popup"></div>
</div>

<script>
const icons=['ğŸŒ±','ğŸŒ±','â™»ï¸','â™»ï¸','ğŸ¾','ğŸ¾','ğŸŒ','ğŸŒ','ğŸ’§','ğŸ’§','ğŸŒ³','ğŸŒ³'];
const grid=document.getElementById('grid');
const timeEl=document.getElementById('time');
const movesEl=document.getElementById('moves');
const overlay=document.getElementById('overlay');
const popup=document.getElementById('popup');
const startBtn=document.getElementById('startBtn');
const statusText=document.getElementById('status');
const mainContent=document.getElementById('mainContent');

let first=null, second=null, lock=false;
let moves=0, matched=0, time=40, timer;

/* ---------- GAME SETUP ---------- */
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function setupGame(){
  grid.innerHTML='';
  shuffle(icons);
  icons.forEach(icon=>{
    const card=document.createElement('div');
    card.className='card';
    card.dataset.icon=icon;
    card.textContent='?';
    card.onclick=()=>flip(card);
    grid.appendChild(card);
  });
}

function resetGame(){
  clearInterval(timer);
  time=40; moves=0; matched=0;
  timeEl.textContent=time;
  movesEl.textContent=moves;
  statusText.textContent='';
  grid.style.display='grid';
}

/* ---------- GAME FLOW ---------- */
function startGame(){
  resetGame();
  setupGame();
  showPopup('ğŸ‘€ Get Ready!', false);

  setTimeout(()=>{
    hidePopup();

    document.querySelectorAll('.card').forEach(c=>{
      c.classList.add('open');
      c.textContent=c.dataset.icon;
    });

    setTimeout(()=>{
      document.querySelectorAll('.card').forEach(c=>{
        c.classList.remove('open');
        c.textContent='?';
      });

      statusText.textContent='ğŸ¯ Start Matching!';
      startTimer();
    },6000);

  },2000);
}

/* ---------- TIMER ---------- */
function startTimer(){
  timer=setInterval(()=>{
    time--;
    timeEl.textContent=time;
    if(time===0) endGame(false);
  },1000);
}

/* ---------- CARD LOGIC ---------- */
function flip(card){
  if(lock || card.classList.contains('matched') || card===first) return;

  card.classList.add('open');
  card.textContent=card.dataset.icon;

  if(!first){
    first=card;
  }else{
    second=card;
    lock=true;
    moves++;
    movesEl.textContent=moves;

    if(first.dataset.icon===second.dataset.icon){
      first.classList.add('matched');
      second.classList.add('matched');
      matched+=2;
      resetTurn();
      if(matched===icons.length) endGame(true);
    }else{
      setTimeout(()=>{
        first.classList.remove('open');
        second.classList.remove('open');
        first.textContent='?';
        second.textContent='?';
        resetTurn();
      },700);
    }
  }
}

function resetTurn(){
  first=second=null;
  lock=false;
}

/* ---------- POPUPS ---------- */
function showPopup(msg, isFinal){
  mainContent.style.display='none';
  popup.innerHTML = isFinal ? msg : `<h2>${msg}</h2>`;
  overlay.style.display='flex';
}

function hidePopup(){
  overlay.style.display='none';
  mainContent.style.display='grid';
}

function endGame(win){
  clearInterval(timer);
  showPopup(`
    <h2>${win?'ğŸ‰ You Win!':'âŒ You Lose!'}</h2>
    <p>${win?'Amazing memory!':'Time is over. Try again!'}</p>
    <button class="btn" onclick="location.reload()">ğŸ” Try Again</button>
    <button class="btn secondary" onclick="location.href='kids-quiz-dashboard.html'">
      ğŸ  Back to Dashboard
    </button>
  `, true);
}

/* ---------- EVENT ---------- */
startBtn.onclick=startGame;
</script>

<!-- Footer placeholder -->
  <div id="footer-placeholder"></div>
<script src="/frontend/js/components/footer-loader.js"></script>
<script src="../../js/components/component-loader.js"></script>
    <script src="../../js/components/navbar-loader.js"></script>
</body>
</html>
