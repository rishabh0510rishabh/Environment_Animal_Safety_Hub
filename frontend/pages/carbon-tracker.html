<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carbon Footprint Tracker - EcoLife</title>
  <link rel="stylesheet" href="../css/global/variables.css">
  <link rel="stylesheet" href="../css/global/utilities.css">
  <link rel="stylesheet" href="../css/components/navbar.css">
  <link rel="stylesheet" href="../css/components/footer.css">
  <link rel="stylesheet" href="../css/global/accessibility.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; background: #f8f9fa; }
    .tracker-hero { background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; padding: 80px 20px 60px; text-align: center; }
    .tracker-hero h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    .tracker-hero p { font-size: 1.1rem; opacity: 0.9; }
    .tracker-container { max-width: 1200px; margin: -40px auto 60px; padding: 0 20px; }
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
    .dashboard-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
    .card-header h3 { margin: 0; color: #2E7D32; }
    .card-header i { font-size: 1.5rem; color: #4CAF50; }
    .stats-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .stat-value { font-size: 2rem; font-weight: 600; color: #4CAF50; }
    .stat-label { color: #666; font-size: 0.9rem; }
    .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin: 10px 0; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #4CAF50, #2E7D32); transition: width 0.3s; }
    .activity-form { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
    .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { margin-bottom: 5px; font-weight: 600; color: #333; }
    .form-group input, .form-group select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #4CAF50; }
    .btn-primary { background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; min-height: 44px; }
    .btn-primary:hover { background: #45a049; transform: translateY(-2px); }
    .btn-secondary { background: white; color: #4CAF50; padding: 12px 24px; border: 2px solid #4CAF50; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; min-height: 44px; }
    .btn-secondary:hover { background: #4CAF50; color: white; }
    .chart-container { position: relative; height: 300px; margin: 20px 0; }
    .activity-log { max-height: 300px; overflow-y: auto; }
    .log-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e0e0e0; }
    .log-item:last-child { border-bottom: none; }
    .log-activity { font-weight: 600; color: #333; }
    .log-emission { color: #e74c3c; font-weight: 600; }
    .log-date { color: #666; font-size: 0.9rem; }
    .goal-setting { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
    .goal-input { display: flex; gap: 15px; align-items: end; margin-bottom: 20px; }
    .goal-progress { background: #f8f9fa; padding: 20px; border-radius: 8px; }
    .achievements { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
    .achievement { text-align: center; padding: 15px; background: #e8f5e8; border-radius: 8px; }
    .achievement.unlocked { background: #4CAF50; color: white; }
    .achievement-icon { font-size: 2rem; margin-bottom: 10px; }
    .tips-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .tips-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .tip-card { padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4CAF50; }
    .tip-card h4 { margin: 0 0 10px; color: #2E7D32; }
    .tip-card p { margin: 0; color: #666; font-size: 0.9rem; }
    .comparison-chart { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
    @media (max-width: 768px) {
      .tracker-hero h1 { font-size: 2rem; }
      .form-row { grid-template-columns: 1fr; }
      .goal-input { flex-direction: column; align-items: stretch; }
      .dashboard-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="navbar-container"></div>

  <main>
    <section class="tracker-hero">
      <h1>üìä Carbon Footprint Tracker</h1>
      <p>Track your daily activities and reduce your environmental impact</p>
    </section>

    <div class="tracker-container">
      <!-- Dashboard Overview -->
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <div class="card-header">
            <i class="fas fa-chart-line"></i>
            <h3>Today's Footprint</h3>
          </div>
          <div class="stats-row">
            <div>
              <div class="stat-value" id="todayEmissions">0</div>
              <div class="stat-label">kg CO‚ÇÇ today</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 1.2rem; color: #666;">Goal: <span id="dailyGoal">5</span> kg</div>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="todayProgress" style="width: 0%"></div>
          </div>
        </div>

        <div class="dashboard-card">
          <div class="card-header">
            <i class="fas fa-calendar-month"></i>
            <h3>This Month</h3>
          </div>
          <div class="stats-row">
            <div>
              <div class="stat-value" id="monthEmissions">0</div>
              <div class="stat-label">kg CO‚ÇÇ this month</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 1.2rem; color: #666;">Avg: <span id="monthlyAvg">0</span> kg/day</div>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="monthProgress" style="width: 0%"></div>
          </div>
        </div>

        <div class="dashboard-card">
          <div class="card-header">
            <i class="fas fa-trophy"></i>
            <h3>Achievements</h3>
          </div>
          <div class="achievements">
            <div class="achievement" id="achievement1">
              <div class="achievement-icon">üå±</div>
              <div>First Log</div>
            </div>
            <div class="achievement" id="achievement2">
              <div class="achievement-icon">üéØ</div>
              <div>Goal Met</div>
            </div>
            <div class="achievement" id="achievement3">
              <div class="achievement-icon">üìÖ</div>
              <div>7 Day Streak</div>
            </div>
            <div class="achievement" id="achievement4">
              <div class="achievement-icon">üèÜ</div>
              <div>Eco Warrior</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Logging Form -->
      <div class="activity-form">
        <div class="card-header">
          <i class="fas fa-plus-circle"></i>
          <h3>Log Daily Activity</h3>
        </div>
        <form id="activityForm">
          <div class="form-row">
            <div class="form-group">
              <label>Activity Type</label>
              <select id="activityType" required>
                <option value="">Select Activity</option>
                <option value="transport">üöó Transportation</option>
                <option value="energy">‚ö° Energy Usage</option>
                <option value="food">üçΩÔ∏è Food & Diet</option>
                <option value="waste">üóëÔ∏è Waste</option>
                <option value="shopping">üõçÔ∏è Shopping</option>
              </select>
            </div>
            <div class="form-group">
              <label>Specific Activity</label>
              <select id="specificActivity" required>
                <option value="">Select specific activity</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity</label>
              <input type="number" id="quantity" placeholder="Enter amount" required>
            </div>
            <div class="form-group">
              <label>Unit</label>
              <select id="unit" required>
                <option value="">Select unit</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn-primary">
            <i class="fas fa-plus"></i> Add Activity
          </button>
        </form>
      </div>

      <!-- Goal Setting -->
      <div class="goal-setting">
        <div class="card-header">
          <i class="fas fa-bullseye"></i>
          <h3>Carbon Footprint Goals</h3>
        </div>
        <div class="goal-input">
          <div class="form-group">
            <label>Daily Goal (kg CO‚ÇÇ)</label>
            <input type="number" id="dailyGoalInput" value="5" min="1" max="50">
          </div>
          <div class="form-group">
            <label>Monthly Goal (kg CO‚ÇÇ)</label>
            <input type="number" id="monthlyGoalInput" value="150" min="30" max="1500">
          </div>
          <button class="btn-secondary" onclick="updateGoals()">Update Goals</button>
        </div>
        <div class="goal-progress">
          <h4 style="margin: 0 0 15px; color: #2E7D32;">Progress Towards Goals</h4>
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Daily Progress</span>
            <span id="dailyProgressText">0% of goal</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="dailyGoalProgress" style="width: 0%"></div>
          </div>
          <div style="display: flex; justify-content: space-between; margin: 20px 0 10px;">
            <span>Monthly Progress</span>
            <span id="monthlyProgressText">0% of goal</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="monthlyGoalProgress" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="comparison-chart">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <h3>Trend Analysis</h3>
        </div>
        <div class="chart-container">
          <canvas id="trendChart"></canvas>
        </div>
      </div>

      <div class="dashboard-grid">
        <!-- Activity Log -->
        <div class="dashboard-card">
          <div class="card-header">
            <i class="fas fa-list"></i>
            <h3>Recent Activities</h3>
          </div>
          <div class="activity-log" id="activityLog">
            <div class="log-item">
              <div>
                <div class="log-activity">No activities logged yet</div>
                <div class="log-date">Start tracking your carbon footprint!</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Category Breakdown -->
        <div class="dashboard-card">
          <div class="card-header">
            <i class="fas fa-chart-pie"></i>
            <h3>Category Breakdown</h3>
          </div>
          <div class="chart-container">
            <canvas id="categoryChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Tips Section -->
      <div class="tips-section">
        <div class="card-header">
          <i class="fas fa-lightbulb"></i>
          <h3>Reduction Tips</h3>
        </div>
        <div class="tips-grid">
          <div class="tip-card">
            <h4>üöó Transportation</h4>
            <p>Use public transport or bike for short trips. Carpool when possible to reduce emissions by up to 45%.</p>
          </div>
          <div class="tip-card">
            <h4>‚ö° Energy Saving</h4>
            <p>Switch to LED bulbs and unplug devices when not in use. This can reduce energy consumption by 20%.</p>
          </div>
          <div class="tip-card">
            <h4>üçΩÔ∏è Sustainable Diet</h4>
            <p>Try meatless meals twice a week. Plant-based diets can reduce food-related emissions by 30%.</p>
          </div>
          <div class="tip-card">
            <h4>‚ôªÔ∏è Waste Reduction</h4>
            <p>Recycle properly and compost organic waste. Avoid single-use plastics to minimize waste footprint.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-container"></div>

  <script>
    // Activity data and emission factors
    const activityData = {
      transport: {
        'car-petrol': { unit: 'km', factor: 0.21, label: 'Car (Petrol)' },
        'car-diesel': { unit: 'km', factor: 0.17, label: 'Car (Diesel)' },
        'motorcycle': { unit: 'km', factor: 0.11, label: 'Motorcycle' },
        'bus': { unit: 'km', factor: 0.05, label: 'Bus' },
        'train': { unit: 'km', factor: 0.03, label: 'Train' },
        'flight-domestic': { unit: 'km', factor: 0.25, label: 'Domestic Flight' },
        'flight-international': { unit: 'km', factor: 0.35, label: 'International Flight' }
      },
      energy: {
        'electricity': { unit: 'kWh', factor: 0.82, label: 'Electricity Usage' },
        'natural-gas': { unit: 'cubic meters', factor: 2.0, label: 'Natural Gas' },
        'heating-oil': { unit: 'liters', factor: 2.5, label: 'Heating Oil' }
      },
      food: {
        'beef': { unit: 'kg', factor: 27, label: 'Beef' },
        'pork': { unit: 'kg', factor: 12, label: 'Pork' },
        'chicken': { unit: 'kg', factor: 6.9, label: 'Chicken' },
        'fish': { unit: 'kg', factor: 6.1, label: 'Fish' },
        'dairy': { unit: 'liters', factor: 3.2, label: 'Dairy Products' },
        'vegetables': { unit: 'kg', factor: 2.0, label: 'Vegetables' }
      },
      waste: {
        'general-waste': { unit: 'kg', factor: 0.5, label: 'General Waste' },
        'plastic-waste': { unit: 'kg', factor: 6.0, label: 'Plastic Waste' },
        'paper-waste': { unit: 'kg', factor: 1.3, label: 'Paper Waste' }
      },
      shopping: {
        'clothing': { unit: 'items', factor: 10, label: 'Clothing Items' },
        'electronics': { unit: 'items', factor: 300, label: 'Electronics' },
        'books': { unit: 'items', factor: 7.5, label: 'Books' }
      }
    };

    // Load stored data
    let activities = JSON.parse(localStorage.getItem('carbonActivities') || '[]');
    let goals = JSON.parse(localStorage.getItem('carbonGoals') || '{"daily": 5, "monthly": 150}');

    // Load navbar and footer
    fetch('../components/navbar.html').then(r => r.text()).then(html => {
      document.getElementById('navbar-container').innerHTML = html;
    });
    fetch('../components/footer.html').then(r => r.text()).then(html => {
      document.getElementById('footer-container').innerHTML = html;
    });

    // Update specific activity dropdown
    document.getElementById('activityType').addEventListener('change', function() {
      const specificSelect = document.getElementById('specificActivity');
      const unitSelect = document.getElementById('unit');
      const category = this.value;
      
      specificSelect.innerHTML = '<option value="">Select specific activity</option>';
      unitSelect.innerHTML = '<option value="">Select unit</option>';
      
      if (category && activityData[category]) {
        Object.entries(activityData[category]).forEach(([key, data]) => {
          specificSelect.innerHTML += `<option value="${key}">${data.label}</option>`;
        });
      }
    });

    // Update unit dropdown
    document.getElementById('specificActivity').addEventListener('change', function() {
      const category = document.getElementById('activityType').value;
      const activity = this.value;
      const unitSelect = document.getElementById('unit');
      
      if (category && activity && activityData[category][activity]) {
        const unit = activityData[category][activity].unit;
        unitSelect.innerHTML = `<option value="${unit}">${unit}</option>`;
      }
    });

    // Form submission
    document.getElementById('activityForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const category = document.getElementById('activityType').value;
      const activity = document.getElementById('specificActivity').value;
      const quantity = parseFloat(document.getElementById('quantity').value);
      const unit = document.getElementById('unit').value;
      
      if (category && activity && quantity && activityData[category][activity]) {
        const emission = quantity * activityData[category][activity].factor;
        
        const newActivity = {
          id: Date.now(),
          date: new Date().toISOString().split('T')[0],
          category,
          activity,
          activityLabel: activityData[category][activity].label,
          quantity,
          unit,
          emission: parseFloat(emission.toFixed(2)),
          timestamp: new Date().toISOString()
        };
        
        activities.unshift(newActivity);
        localStorage.setItem('carbonActivities', JSON.stringify(activities));
        
        this.reset();
        updateDashboard();
        updateCharts();
        updateActivityLog();
        checkAchievements();
      }
    });

    // Update goals
    function updateGoals() {
      goals.daily = parseFloat(document.getElementById('dailyGoalInput').value);
      goals.monthly = parseFloat(document.getElementById('monthlyGoalInput').value);
      localStorage.setItem('carbonGoals', JSON.stringify(goals));
      updateDashboard();
    }

    // Update dashboard
    function updateDashboard() {
      const today = new Date().toISOString().split('T')[0];
      const thisMonth = new Date().toISOString().slice(0, 7);
      
      // Today's emissions
      const todayActivities = activities.filter(a => a.date === today);
      const todayTotal = todayActivities.reduce((sum, a) => sum + a.emission, 0);
      
      // This month's emissions
      const monthActivities = activities.filter(a => a.date.startsWith(thisMonth));
      const monthTotal = monthActivities.reduce((sum, a) => sum + a.emission, 0);
      const monthAvg = monthActivities.length > 0 ? monthTotal / new Date().getDate() : 0;
      
      // Update display
      document.getElementById('todayEmissions').textContent = todayTotal.toFixed(1);
      document.getElementById('monthEmissions').textContent = monthTotal.toFixed(1);
      document.getElementById('monthlyAvg').textContent = monthAvg.toFixed(1);
      document.getElementById('dailyGoal').textContent = goals.daily;
      
      // Update progress bars
      const todayProgress = Math.min((todayTotal / goals.daily) * 100, 100);
      const monthProgress = Math.min((monthTotal / goals.monthly) * 100, 100);
      
      document.getElementById('todayProgress').style.width = todayProgress + '%';
      document.getElementById('monthProgress').style.width = monthProgress + '%';
      document.getElementById('dailyGoalProgress').style.width = todayProgress + '%';
      document.getElementById('monthlyGoalProgress').style.width = monthProgress + '%';
      
      document.getElementById('dailyProgressText').textContent = todayProgress.toFixed(0) + '% of goal';
      document.getElementById('monthlyProgressText').textContent = monthProgress.toFixed(0) + '% of goal';
    }

    // Update activity log
    function updateActivityLog() {
      const logContainer = document.getElementById('activityLog');
      
      if (activities.length === 0) {
        logContainer.innerHTML = `
          <div class="log-item">
            <div>
              <div class="log-activity">No activities logged yet</div>
              <div class="log-date">Start tracking your carbon footprint!</div>
            </div>
          </div>
        `;
        return;
      }
      
      logContainer.innerHTML = activities.slice(0, 10).map(activity => `
        <div class="log-item">
          <div>
            <div class="log-activity">${activity.activityLabel}</div>
            <div class="log-date">${activity.quantity} ${activity.unit} ‚Ä¢ ${new Date(activity.timestamp).toLocaleDateString()}</div>
          </div>
          <div class="log-emission">${activity.emission} kg CO‚ÇÇ</div>
        </div>
      `).join('');
    }

    // Initialize charts
    let trendChart, categoryChart;

    function updateCharts() {
      // Trend Chart
      const last7Days = [];
      const today = new Date();
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        last7Days.push(date.toISOString().split('T')[0]);
      }
      
      const trendData = last7Days.map(date => {
        const dayActivities = activities.filter(a => a.date === date);
        return dayActivities.reduce((sum, a) => sum + a.emission, 0);
      });
      
      if (trendChart) trendChart.destroy();
      
      const trendCtx = document.getElementById('trendChart').getContext('2d');
      trendChart = new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: last7Days.map(date => new Date(date).toLocaleDateString('en-US', { weekday: 'short' })),
          datasets: [{
            label: 'Daily Emissions (kg CO‚ÇÇ)',
            data: trendData,
            borderColor: '#4CAF50',
            backgroundColor: 'rgba(76, 175, 80, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
      
      // Category Chart
      const categoryTotals = {};
      activities.forEach(activity => {
        categoryTotals[activity.category] = (categoryTotals[activity.category] || 0) + activity.emission;
      });
      
      if (categoryChart) categoryChart.destroy();
      
      const categoryCtx = document.getElementById('categoryChart').getContext('2d');
      categoryChart = new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(categoryTotals).map(cat => cat.charAt(0).toUpperCase() + cat.slice(1)),
          datasets: [{
            data: Object.values(categoryTotals),
            backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#E91E63', '#9C27B0']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // Check achievements
    function checkAchievements() {
      const achievements = {
        achievement1: activities.length > 0,
        achievement2: activities.some(a => {
          const dayTotal = activities.filter(act => act.date === a.date).reduce((sum, act) => sum + act.emission, 0);
          return dayTotal <= goals.daily;
        }),
        achievement3: checkStreak() >= 7,
        achievement4: activities.length >= 30 && checkStreak() >= 30
      };
      
      Object.entries(achievements).forEach(([id, unlocked]) => {
        const element = document.getElementById(id);
        if (unlocked) {
          element.classList.add('unlocked');
        }
      });
    }

    function checkStreak() {
      if (activities.length === 0) return 0;
      
      const dates = [...new Set(activities.map(a => a.date))].sort().reverse();
      let streak = 0;
      const today = new Date().toISOString().split('T')[0];
      
      for (let i = 0; i < dates.length; i++) {
        const expectedDate = new Date();
        expectedDate.setDate(expectedDate.getDate() - i);
        const expectedDateStr = expectedDate.toISOString().split('T')[0];
        
        if (dates[i] === expectedDateStr) {
          streak++;
        } else {
          break;
        }
      }
      
      return streak;
    }

    // Initialize
    document.getElementById('dailyGoalInput').value = goals.daily;
    document.getElementById('monthlyGoalInput').value = goals.monthly;
    updateDashboard();
    updateActivityLog();
    updateCharts();
    checkAchievements();
  </script>
</body>
</html>