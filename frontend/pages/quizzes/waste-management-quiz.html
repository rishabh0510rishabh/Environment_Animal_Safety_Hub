<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Waste Management Quiz | EcoLife</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<link rel="stylesheet" href="../../css/pages/quizzes/waste-management-quiz.css">
<link rel="stylesheet" href="../../css/global/utilities.css" />
  <link rel="stylesheet" href="../../css/components/footer.css" />
  <link rel="stylesheet" href="../../css/components/navbar.css" />
  
  <!-- WhatsApp Button CSS -->
  <style>
    .whatsapp-btn {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-width: 200px;
    }
    
    .whatsapp-btn:hover {
      background-color: #128C7E;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
    }
    
    .whatsapp-btn i {
      font-size: 18px;
    }
    
    #resultScreen button:not(.whatsapp-btn) {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px;
      min-width: 200px;
    }
    
    #resultScreen button:not(.whatsapp-btn):hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }
    
    .result-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .result-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .result-buttons button {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>

<body>

  <div id="cursor-container"></div>
<script src="../../js/components/loadComponents.js"></script>

  <div id="navbar-container"></div>

<div class="hero">
  <h1>‚ôªÔ∏è Waste Management Quiz</h1>
  <p>Learn to segregate waste & keep Earth clean üåç</p>
</div>

<div class="card">

  <!-- START -->
  <div id="startScreen">
    <h2>Ready to Test Your Waste Skills?</h2>
    <p>10 questions ‚Ä¢ 3 minutes</p>
    <button onclick="startQuiz()">Start Quiz</button>

    <!-- Resume Section -->
    <div id="resumeSection" style="display: none; margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; border: 2px solid #4CAF50;">
      <h3 style="color: #2E7D32; margin-bottom: 10px;">üìö Resume Your Previous Quiz</h3>
      <p style="margin-bottom: 15px; color: #555;">You have an unfinished quiz. Would you like to continue where you left off?</p>
      <button onclick="resumeSavedQuiz()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">Resume Quiz</button>
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quizScreen">
    <div class="timer">‚è≥ Time Left: <span id="time">03:00</span></div>
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-metrics">
        <span id="timeSpent">Time Spent: 0s</span> | <span id="questionsCompleted">Completed: 0/10</span>
      </div>
    </div>
    <div class="pause-resume-buttons">
      <button class="btn-secondary" id="pauseBtn" onclick="pauseQuiz()">‚è∏Ô∏è Pause</button>
      <button class="btn-secondary" id="resumeBtn" onclick="resumeQuiz()" style="display:none;">‚ñ∂Ô∏è Resume</button>
    </div>
    <div class="question" id="question"></div>
    <div id="options"></div>
    <button onclick="nextQuestion()" id="nextBtn">Next</button>
  </div>

  <!-- RESULT -->
  <div id="resultScreen">
    <h2>üéâ Quiz Completed!</h2>
    <div class="score" id="score"></div>
    <p id="remark"></p>
    
    <div class="result-buttons">
      <button onclick="location.reload()">Play Again</button>
      <!-- WhatsApp Share Button Added Here -->
      <button class="whatsapp-btn" id="whatsappShareBtn">
        <i class="fab fa-whatsapp"></i> Share Score
      </button>
    </div>
  </div>

</div>

<div class="back-wrapper">
  <button onclick="window.location.href='../games/kids-zone.html'">‚¨Ö Back to Dashboard</button>
</div>

<!-- Footer placeholder -->
  <div id="footer-placeholder"></div>

<!-- Inline JavaScript for Quiz -->
<script>
  // Quiz Questions Data
  const quizQuestions = [
    {
      question: "Which bin should plastic bottles go in?",
      options: ["Recycling", "General Waste", "Compost", "Hazardous Waste"],
      correct: 0,
      explanation: "Plastic bottles should go in the recycling bin as they can be processed and reused."
    },
    {
      question: "What should you do with food waste?",
      options: ["Throw in general waste", "Put in compost bin", "Burn it", "Flush down toilet"],
      correct: 1,
      explanation: "Food waste should be composted to create nutrient-rich soil for plants."
    },
    {
      question: "Which of these is NOT recyclable?",
      options: ["Glass bottles", "Pizza boxes with grease", "Aluminum cans", "Newspaper"],
      correct: 1,
      explanation: "Pizza boxes with grease stains cannot be recycled as the grease contaminates the paper recycling process."
    },
    {
      question: "What does the 3Rs principle stand for?",
      options: ["Reduce, Reuse, Recycle", "Read, Remember, Recite", "React, Respond, Recover", "Rest, Relax, Refresh"],
      correct: 0,
      explanation: "The 3Rs are Reduce (waste generation), Reuse (items), and Recycle (materials)."
    },
    {
      question: "Which material takes the longest to decompose?",
      options: ["Paper (2-6 weeks)", "Plastic bag (10-20 years)", "Glass (1 million years)", "Aluminum can (80-200 years)"],
      correct: 2,
      explanation: "Glass can take up to 1 million years to decompose, which is why recycling it is so important."
    },
    {
      question: "What should you do with batteries?",
      options: ["Throw in general waste", "Put in recycling bin", "Take to special collection point", "Bury in garden"],
      correct: 2,
      explanation: "Batteries contain hazardous materials and should be taken to special collection points for proper disposal."
    },
    {
      question: "Which type of plastic is commonly recycled?",
      options: ["PET (Type 1)", "PVC (Type 3)", "PS (Type 6)", "Other (Type 7)"],
      correct: 0,
      explanation: "PET (Type 1) plastic, used for water and soda bottles, is the most commonly recycled plastic."
    },
    {
      question: "What is e-waste?",
      options: ["Electronic waste", "Eco-friendly waste", "Edible waste", "Emergency waste"],
      correct: 0,
      explanation: "E-waste refers to discarded electronic devices like computers, phones, and appliances."
    },
    {
      question: "Which of these should go in general waste?",
      options: ["Plastic wrap", "Glass jars", "Cardboard boxes", "Metal cans"],
      correct: 0,
      explanation: "Plastic wrap is not typically recyclable and should go in general waste."
    },
    {
      question: "What percentage of household waste can be composted?",
      options: ["20-30%", "40-50%", "60-70%", "80-90%"],
      correct: 1,
      explanation: "Approximately 40-50% of household waste is organic material that can be composted."
    }
  ];

  // Quiz Variables
  let currentQuestion = 0;
  let score = 0;
  let timeLeft = 180; // 3 minutes in seconds
  let timerInterval;
  let quizPaused = false;
  let selectedAnswer = null;
  let quizStarted = false;
  let startTime = null;
  let totalTimeSpent = 0;

  // DOM Elements
  const startScreen = document.getElementById('startScreen');
  const quizScreen = document.getElementById('quizScreen');
  const resultScreen = document.getElementById('resultScreen');
  const questionElement = document.getElementById('question');
  const optionsElement = document.getElementById('options');
  const scoreElement = document.getElementById('score');
  const remarkElement = document.getElementById('remark');
  const timeElement = document.getElementById('time');
  const progressFill = document.getElementById('progressFill');
  const questionsCompletedElement = document.getElementById('questionsCompleted');
  const timeSpentElement = document.getElementById('timeSpent');
  const pauseBtn = document.getElementById('pauseBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const nextBtn = document.getElementById('nextBtn');

  // Initialize Quiz
  function initQuiz() {
    // Check for saved quiz state
    const savedQuiz = localStorage.getItem('wasteQuizState');
    if (savedQuiz) {
      const quizState = JSON.parse(savedQuiz);
      if (quizState.currentQuestion > 0) {
        document.getElementById('resumeSection').style.display = 'block';
      }
    }
    
    // Update time spent display
    updateTimeSpentDisplay();
  }

  // Start Quiz
  function startQuiz() {
    quizStarted = true;
    startTime = Date.now();
    startScreen.style.display = 'none';
    quizScreen.style.display = 'block';
    
    // Clear any saved state
    localStorage.removeItem('wasteQuizState');
    
    // Start timer
    startTimer();
    
    // Load first question
    loadQuestion();
  }

  // Resume Saved Quiz
  function resumeSavedQuiz() {
    const savedQuiz = JSON.parse(localStorage.getItem('wasteQuizState'));
    if (savedQuiz) {
      currentQuestion = savedQuiz.currentQuestion;
      score = savedQuiz.score;
      timeLeft = savedQuiz.timeLeft;
      totalTimeSpent = savedQuiz.totalTimeSpent || 0;
      
      startScreen.style.display = 'none';
      quizScreen.style.display = 'block';
      quizStarted = true;
      startTime = Date.now() - (totalTimeSpent * 1000);
      
      startTimer();
      loadQuestion();
    }
  }

  // Start Timer
  function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(updateTimer, 1000);
  }

  // Update Timer
  function updateTimer() {
    if (!quizPaused) {
      timeLeft--;
      
      // Update display
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Update time spent
      totalTimeSpent = Math.floor((Date.now() - startTime) / 1000);
      updateTimeSpentDisplay();
      
      // Check if time's up
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        endQuiz();
      }
      
      // Auto-save quiz state every 30 seconds
      if (timeLeft % 30 === 0) {
        saveQuizState();
      }
    }
  }

  // Update Time Spent Display
  function updateTimeSpentDisplay() {
    const minutes = Math.floor(totalTimeSpent / 60);
    const seconds = totalTimeSpent % 60;
    timeSpentElement.textContent = `Time Spent: ${minutes}m ${seconds}s`;
  }

  // Pause Quiz
  function pauseQuiz() {
    quizPaused = true;
    pauseBtn.style.display = 'none';
    resumeBtn.style.display = 'inline-block';
    clearInterval(timerInterval);
    saveQuizState();
  }

  // Resume Quiz
  function resumeQuiz() {
    quizPaused = false;
    pauseBtn.style.display = 'inline-block';
    resumeBtn.style.display = 'none';
    startTimer();
  }

  // Save Quiz State
  function saveQuizState() {
    const quizState = {
      currentQuestion: currentQuestion,
      score: score,
      timeLeft: timeLeft,
      totalTimeSpent: totalTimeSpent,
      timestamp: Date.now()
    };
    localStorage.setItem('wasteQuizState', JSON.stringify(quizState));
  }

  // Load Question
  function loadQuestion() {
    if (currentQuestion >= quizQuestions.length) {
      endQuiz();
      return;
    }
    
    const question = quizQuestions[currentQuestion];
    questionElement.textContent = question.question;
    
    // Clear previous options
    optionsElement.innerHTML = '';
    
    // Add options
    question.options.forEach((option, index) => {
      const optionElement = document.createElement('div');
      optionElement.className = 'option';
      optionElement.innerHTML = `
        <span class="option-letter">${String.fromCharCode(65 + index)}</span>
        <span class="option-text">${option}</span>
      `;
      
      optionElement.addEventListener('click', () => selectAnswer(index));
      optionsElement.appendChild(optionElement);
    });
    
    // Update progress
    const progressPercentage = (currentQuestion / quizQuestions.length) * 100;
    progressFill.style.width = `${progressPercentage}%`;
    questionsCompletedElement.textContent = `Completed: ${currentQuestion}/${quizQuestions.length}`;
    
    // Reset selected answer
    selectedAnswer = null;
    nextBtn.disabled = true;
  }

  // Select Answer
  function selectAnswer(index) {
    // Remove previous selection
    document.querySelectorAll('.option').forEach(option => {
      option.classList.remove('selected');
    });
    
    // Add selection to current option
    document.querySelectorAll('.option')[index].classList.add('selected');
    selectedAnswer = index;
    nextBtn.disabled = false;
  }

  // Next Question
  function nextQuestion() {
    if (selectedAnswer === null) {
      alert('Please select an answer before proceeding!');
      return;
    }
    
    // Check if answer is correct
    const question = quizQuestions[currentQuestion];
    const options = document.querySelectorAll('.option');
    
    if (selectedAnswer === question.correct) {
      options[selectedAnswer].classList.add('correct');
      score++;
    } else {
      options[selectedAnswer].classList.add('incorrect');
      options[question.correct].classList.add('correct');
    }
    
    // Show explanation
    const explanationDiv = document.createElement('div');
    explanationDiv.className = 'explanation';
    explanationDiv.innerHTML = `<p><strong>Explanation:</strong> ${question.explanation}</p>`;
    optionsElement.appendChild(explanationDiv);
    
    // Disable further selection
    document.querySelectorAll('.option').forEach(option => {
      option.style.pointerEvents = 'none';
    });
    
    // Wait 2 seconds before next question
    setTimeout(() => {
      currentQuestion++;
      
      if (currentQuestion < quizQuestions.length) {
        loadQuestion();
      } else {
        endQuiz();
      }
    }, 2000);
  }

  // End Quiz
  function endQuiz() {
    clearInterval(timerInterval);
    quizScreen.style.display = 'none';
    resultScreen.style.display = 'block';
    
    // Calculate score
    const percentage = (score / quizQuestions.length) * 100;
    scoreElement.textContent = `${score}/${quizQuestions.length}`;
    
    // Set remark based on score
    let remark = '';
    if (percentage >= 90) {
      remark = "üéØ Waste Management Expert! You're a recycling superstar! üåü";
    } else if (percentage >= 70) {
      remark = "üëç Great job! You know your waste management well!";
    } else if (percentage >= 50) {
      remark = "üìö Good effort! Keep learning about waste segregation!";
    } else {
      remark = "üå± Room for improvement! Check out our waste management tips!";
    }
    
    remarkElement.textContent = remark;
    
    // Save final results
    const quizResults = {
      score: score,
      total: quizQuestions.length,
      percentage: percentage,
      timeSpent: totalTimeSpent,
      date: new Date().toISOString()
    };
    localStorage.setItem('wasteQuizResults', JSON.stringify(quizResults));
    
    // Clear saved state
    localStorage.removeItem('wasteQuizState');
  }

  // Restart Quiz
  function restartQuiz() {
    currentQuestion = 0;
    score = 0;
    timeLeft = 180;
    totalTimeSpent = 0;
    selectedAnswer = null;
    quizStarted = false;
    
    startScreen.style.display = 'block';
    quizScreen.style.display = 'none';
    resultScreen.style.display = 'none';
    
    clearInterval(timerInterval);
    localStorage.removeItem('wasteQuizState');
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initQuiz);

  // WhatsApp share functionality
  function shareOnWhatsApp() {
    const scoreElement = document.getElementById('score');
    const remarkElement = document.getElementById('remark');
    
    if (!scoreElement || !remarkElement) {
      alert('Please complete the quiz first!');
      return;
    }
    
    const scoreText = scoreElement.innerText || scoreElement.textContent;
    const remarkText = remarkElement.innerText || remarkElement.textContent;
    const currentUrl = window.location.href;
    
    // Create share message
    const shareMessage = `‚ôªÔ∏è *Waste Management Quiz Results* ‚ôªÔ∏è\n\n` +
                       `üèÜ *Score:* ${scoreText}\n` +
                       `üìù *Remark:* ${remarkText}\n\n` +
                       `üåç I just tested my waste management knowledge!\n` +
                       `How good are you at recycling and waste segregation? üóëÔ∏è\n\n` +
                       `üëâ Take the quiz here: ${currentUrl}\n\n` +
                       `#WasteManagement #RecyclingQuiz #GoGreen #ZeroWaste #EcoLife`;
    
    const encodedMessage = encodeURIComponent(shareMessage);
    const whatsappURL = `https://wa.me/?text=${encodedMessage}`;
    
    window.open(whatsappURL, '_blank', 'noopener,noreferrer');
  }

  // Add WhatsApp button event listener
  document.addEventListener('DOMContentLoaded', function() {
    const whatsappBtn = document.getElementById('whatsappShareBtn');
    if (whatsappBtn) {
      whatsappBtn.addEventListener('click', shareOnWhatsApp);
    }
    
    // Also handle the Play Again button
    const playAgainBtn = resultScreen.querySelector('button:not(.whatsapp-btn)');
    if (playAgainBtn) {
      playAgainBtn.addEventListener('click', restartQuiz);
    }
  });

  // Make functions globally available
  window.startQuiz = startQuiz;
  window.resumeSavedQuiz = resumeSavedQuiz;
  window.pauseQuiz = pauseQuiz;
  window.resumeQuiz = resumeQuiz;
  window.nextQuestion = nextQuestion;
  window.shareOnWhatsApp = shareOnWhatsApp;
</script>

<script src="/frontend/js/components/footer-loader.js"></script>
<script src="../../js/components/component-loader.js"></script>
<script src="../../js/components/navbar-loader.js"></script>

</body>
</html>
