class EcoForums{constructor(){this.currentUser=this.getCurrentUser();this.forumData=null;this.currentCategory=null;this.currentThread=null;this.searchQuery='';this.currentFilter='all';this.threadsPerPage=10;this.currentPage=1;this.init();}init(){this.loadForumData();this.setupEventListeners();this.renderCategories();this.renderRecentThreads();this.updateStats();}getCurrentUser(){// Get user from localStorage or session const user=JSON.parse(localStorage.getItem('ecolife_user')|| 'null');return user ||{id: 'guest',name: 'Guest',role: 'user'};}async loadForumData(){try{const response=await fetch('../../assets/data/forums.json');if(!response.ok){// Create default forum data if file doesn't exist this.forumData=this.getDefaultForumData();this.saveForumData();}else{this.forumData=await response.json();}}catch(error){console.error('Error loading forum data:',error);this.forumData=this.getDefaultForumData();}}getDefaultForumData(){return{categories: [{id: 'animal-safety',name: 'Animal Safety',description: 'Discussions about animal welfare,safety tips,and care guidelines',icon: 'fas fa-shield-alt',color: '#e74c3c',threads: 0,posts: 0},{id: 'environment',name: 'Environment',description: 'Environmental conservation,climate change,and sustainability topics',icon: 'fas fa-leaf',color: '#27ae60',threads: 0,posts: 0},{id: 'eco-living',name: 'Eco-Friendly Living',description: 'Sustainable living tips,green products,and lifestyle changes',icon: 'fas fa-recycle',color: '#3498db',threads: 0,posts: 0},{id: 'conservation',name: 'Conservation',description: 'Wildlife conservation,habitat protection,and biodiversity',icon: 'fas fa-tree',color: '#9b59b6',threads: 0,posts: 0}],threads: [],users:{}};}async saveForumData(){try{// In a real app,this would be an API call localStorage.setItem('ecolife_forum_data',JSON.stringify(this.forumData));}catch(error){console.error('Error saving forum data:',error);}}setupEventListeners(){// Search functionality const searchInput=document.getElementById('forum-search');if(searchInput){searchInput.addEventListener('input',(e)=>{this.searchQuery=e.target.value.toLowerCase();this.renderRecentThreads();});}// Filter buttons document.querySelectorAll('.filter-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{document.querySelectorAll('.filter-btn').forEach(b=> b.classList.remove('active'));e.target.classList.add('active');this.currentFilter=e.target.dataset.filter;this.renderRecentThreads();});});// Create thread button const createBtn=document.getElementById('create-thread-btn');if(createBtn){createBtn.addEventListener('click',()=> this.openCreateThreadModal());}// Modal events this.setupModalEvents();}setupModalEvents(){// Create thread modal const createModal=document.getElementById('create-thread-modal');const closeCreateModal=document.getElementById('close-create-modal');const cancelCreate=document.getElementById('cancel-create-thread');const submitCreate=document.getElementById('submit-create-thread');if(closeCreateModal){closeCreateModal.addEventListener('click',()=> this.closeModal(createModal));}if(cancelCreate){cancelCreate.addEventListener('click',()=> this.closeModal(createModal));}if(submitCreate){submitCreate.addEventListener('click',()=> this.createThread());}// Thread modal const threadModal=document.getElementById('thread-modal');const closeThreadModal=document.getElementById('close-thread-modal');if(closeThreadModal){closeThreadModal.addEventListener('click',()=> this.closeModal(threadModal));}// Thread actions const likeBtn=document.getElementById('like-thread-btn');const shareBtn=document.getElementById('share-thread-btn');const pinBtn=document.getElementById('pin-thread-btn');const deleteBtn=document.getElementById('delete-thread-btn');const submitReply=document.getElementById('submit-reply');if(likeBtn)likeBtn.addEventListener('click',()=> this.likeThread());if(shareBtn)shareBtn.addEventListener('click',()=> this.shareThread());if(pinBtn)pinBtn.addEventListener('click',()=> this.pinThread());if(deleteBtn)deleteBtn.addEventListener('click',()=> this.deleteThread());if(submitReply)submitReply.addEventListener('click',()=> this.submitReply());// Close modals when clicking outside [createModal,threadModal].forEach(modal=>{if(modal){modal.addEventListener('click',(e)=>{if(e.target===modal){this.closeModal(modal);}});}});}renderCategories(){const container=document.getElementById('categories-container');if(!container || !this.forumData)return;container.innerHTML=this.forumData.categories.map(category=> ` <div class="category-card" data-category="${category.id}" onclick="ecoForums.openCategory('${category.id}')"> <div class="category-icon" style="background-color: ${category.color}"> <i class="${category.icon}"></i> </div> <div class="category-info"> <h3 class="category-title">${category.name}</h3> <p class="category-description">${category.description}</p> <div class="category-stats"> <span class="stat">${category.threads}threads</span> <span class="stat">${category.posts}posts</span> </div> </div> <div class="category-arrow"> <i class="fas fa-chevron-right"></i> </div> </div> `).join('');}renderRecentThreads(){const container=document.getElementById('threads-container');if(!container || !this.forumData)return;let threads=[...this.forumData.threads];// Apply search filter if(this.searchQuery){threads=threads.filter(thread=> thread.title.toLowerCase().includes(this.searchQuery)|| thread.content.toLowerCase().includes(this.searchQuery)|| thread.author.name.toLowerCase().includes(this.searchQuery));}// Apply category filter if(this.currentCategory){threads=threads.filter(thread=> thread.category===this.currentCategory);}// Apply time/popularity filters const now=new Date();threads=threads.filter(thread=>{const threadDate=new Date(thread.createdAt);switch(this.currentFilter){case 'recent': return(now-threadDate)<(7 * 24 * 60 * 60 * 1000);// Last 7 days case 'popular': return thread.likes > 5 || thread.replies.length > 10;case 'unanswered': return thread.replies.length===0;default: return true;}});// Sort threads threads.sort((a,b)=>{if(a.pinned && !b.pinned)return-1;if(!a.pinned && b.pinned)return 1;return new Date(b.createdAt)-new Date(a.createdAt);});// Paginate const startIndex=0;const endIndex=this.threadsPerPage;const displayedThreads=threads.slice(startIndex,endIndex);container.innerHTML=displayedThreads.length > 0 ? displayedThreads.map(thread=> this.renderThreadCard(thread)).join(''): '<div class="no-threads">No threads found. Be the first to start a discussion!</div>';// Show/hide load more button const loadMoreBtn=document.getElementById('load-more-btn');if(loadMoreBtn){loadMoreBtn.style.display=threads.length > this.threadsPerPage ? 'block' : 'none';}}renderThreadCard(thread){const category=this.forumData.categories.find(c=> c.id===thread.category);const lastReply=thread.replies.length > 0 ? thread.replies[thread.replies.length-1] : null;const timeAgo=this.getTimeAgo(new Date(thread.createdAt));return ` <div class="thread-card ${thread.pinned ? 'pinned' : ''}" onclick="ecoForums.openThread('${thread.id}')"> <div class="thread-header"> <div class="thread-title-section"> <h3 class="thread-title">${thread.title}</h3> ${thread.pinned ? '<span class="pinned-badge"><i class="fas fa-thumbtack"></i> Pinned</span>' : ''}</div> <div class="thread-meta"> <span class="thread-category" style="background-color: ${category?.color || '#666'}"> ${category?.name || 'General'}</span> <span class="thread-author">by ${thread.author.name}</span> <span class="thread-time">${timeAgo}</span> </div> </div> <div class="thread-preview"> ${thread.content.substring(0,200)}${thread.content.length > 200 ? '...' : ''}</div> <div class="thread-stats"> <div class="stat-item"> <i class="fas fa-reply"></i> <span>${thread.replies.length}replies</span> </div> <div class="stat-item"> <i class="fas fa-heart"></i> <span>${thread.likes}likes</span> </div> ${lastReply ? ` <div class="stat-item"> <span>Last reply ${this.getTimeAgo(new Date(lastReply.createdAt))}by ${lastReply.author.name}</span> </div> ` : ''}</div> </div> `;}updateStats(){const totalThreads=this.forumData.threads.length;const totalReplies=this.forumData.threads.reduce((sum,thread)=> sum+thread.replies.length,0);const activeUsers=new Set([ ...this.forumData.threads.map(t=> t.author.id),...this.forumData.threads.flatMap(t=> t.replies.map(r=> r.author.id))]).size;document.getElementById('total-threads').textContent=totalThreads;document.getElementById('total-replies').textContent=totalReplies;document.getElementById('active-users').textContent=activeUsers;}openCreateThreadModal(){if(!this.isLoggedIn()){alert('Please log in to create a thread.');return;}const modal=document.getElementById('create-thread-modal');const categorySelect=document.getElementById('thread-category');// Populate categories categorySelect.innerHTML='<option value="">Select a category</option>'+this.forumData.categories.map(cat=> `<option value="${cat.id}">${cat.name}</option>`).join('');modal.classList.add('active');}createThread(){const title=document.getElementById('thread-title').value.trim();const category=document.getElementById('thread-category').value;const content=document.getElementById('thread-content').value.trim();const pinned=document.getElementById('thread-pinned').checked;if(!title || !category || !content){alert('Please fill in all required fields.');return;}const thread={id: Date.now().toString(),title,content,category,author: this.currentUser,createdAt: new Date().toISOString(),likes: 0,pinned: pinned && this.isAdmin(),replies: []};this.forumData.threads.unshift(thread);this.updateCategoryStats(category);this.saveForumData();this.renderRecentThreads();this.updateStats();// Close modal and reset form this.closeModal(document.getElementById('create-thread-modal'));document.getElementById('create-thread-form').reset();// Show success message this.showNotification('Thread created successfully!','success');}openThread(threadId){const thread=this.forumData.threads.find(t=> t.id===threadId);if(!thread)return;this.currentThread=thread;const modal=document.getElementById('thread-modal');const category=this.forumData.categories.find(c=> c.id===thread.category);// Update modal content document.getElementById('thread-modal-title').textContent=thread.title;document.getElementById('thread-author').textContent=`by ${thread.author.name}`;document.getElementById('thread-date').textContent=this.formatDate(new Date(thread.createdAt));document.getElementById('thread-category-badge').textContent=category?.name || 'General';document.getElementById('thread-category-badge').style.backgroundColor=category?.color || '#666';document.getElementById('thread-content').innerHTML=this.formatContent(thread.content);document.getElementById('thread-likes').textContent=thread.likes;document.getElementById('replies-count').textContent=thread.replies.length;// Render replies this.renderReplies(thread.replies);// Show/hide admin buttons const adminBtns=modal.querySelectorAll('.admin-only');adminBtns.forEach(btn=>{btn.style.display=this.isAdmin()? 'inline-block' : 'none';});modal.classList.add('active');}renderReplies(replies){const container=document.getElementById('replies-list');if(!container)return;container.innerHTML=replies.map(reply=> ` <div class="reply-item"> <div class="reply-header"> <span class="reply-author">${reply.author.name}</span> <span class="reply-date">${this.formatDate(new Date(reply.createdAt))}</span> </div> <div class="reply-content">${this.formatContent(reply.content)}</div> <div class="reply-actions"> <button class="reply-action-btn" onclick="ecoForums.likeReply('${reply.id}')"> <i class="fas fa-heart"></i> Like </button> ${this.isAdmin()? ` <button class="reply-action-btn delete" onclick="ecoForums.deleteReply('${reply.id}')"> <i class="fas fa-trash"></i> Delete </button> ` : ''}</div> </div> `).join('');}submitReply(){if(!this.isLoggedIn()){alert('Please log in to reply.');return;}const content=document.getElementById('reply-content').value.trim();if(!content){alert('Please enter a reply.');return;}const reply={id: Date.now().toString(),content,author: this.currentUser,createdAt: new Date().toISOString(),likes: 0};this.currentThread.replies.push(reply);this.updateCategoryStats(this.currentThread.category);this.saveForumData();this.renderReplies(this.currentThread.replies);this.updateStats();// Reset form document.getElementById('reply-content').value='';document.getElementById('replies-count').textContent=this.currentThread.replies.length;this.showNotification('Reply posted successfully!','success');}likeThread(){if(!this.isLoggedIn()){alert('Please log in to like threads.');return;}this.currentThread.likes++;document.getElementById('thread-likes').textContent=this.currentThread.likes;this.saveForumData();this.showNotification('Thread liked!','success');}shareThread(){const url=window.location.href;navigator.clipboard.writeText(url).then(()=>{this.showNotification('Thread link copied to clipboard!','success');});}pinThread(){if(!this.isAdmin())return;this.currentThread.pinned=!this.currentThread.pinned;this.saveForumData();this.renderRecentThreads();this.showNotification(`Thread ${this.currentThread.pinned ? 'pinned' : 'unpinned'}!`,'success');}deleteThread(){if(!this.isAdmin())return;if(confirm('Are you sure you want to delete this thread?')){this.forumData.threads=this.forumData.threads.filter(t=> t.id !==this.currentThread.id);this.updateCategoryStats(this.currentThread.category,-1);this.saveForumData();this.renderRecentThreads();this.updateStats();this.closeModal(document.getElementById('thread-modal'));this.showNotification('Thread deleted!','success');}}updateCategoryStats(categoryId,threadDelta=1){const category=this.forumData.categories.find(c=> c.id===categoryId);if(category){category.threads+=threadDelta;// Update posts count(threads+replies)category.posts=this.forumData.threads .filter(t=> t.category===categoryId).reduce((sum,t)=> sum+1+t.replies.length,0);}}openCategory(categoryId){this.currentCategory=categoryId;this.renderRecentThreads();// Scroll to threads section document.querySelector('.threads-section').scrollIntoView({behavior: 'smooth'});}getTimeAgo(date){const now=new Date();const diffInSeconds=Math.floor((now-date)/ 1000);if(diffInSeconds < 60)return `${diffInSeconds}seconds ago`;if(diffInSeconds < 3600)return `${Math.floor(diffInSeconds / 60)}minutes ago`;if(diffInSeconds < 86400)return `${Math.floor(diffInSeconds / 3600)}hours ago`;if(diffInSeconds < 604800)return `${Math.floor(diffInSeconds / 86400)}days ago`;return date.toLocaleDateString();}formatDate(date){return date.toLocaleString();}formatContent(content){// Basic markdown-like formatting return content .replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>');}isLoggedIn(){return this.currentUser.id !=='guest';}isAdmin(){return this.currentUser.role==='admin';}closeModal(modal){modal.classList.remove('active');}showNotification(message,type='info'){// Create notification element const notification=document.createElement('div');notification.className=`notification ${type}`;notification.innerHTML=` <i class="fas fa-${type==='success' ? 'check-circle' : 'info-circle'}"></i> <span>${message}</span> `;// Add to page document.body.appendChild(notification);// Remove after 3 seconds setTimeout(()=>{notification.remove();},3000);}}// Initialize forums when DOM is loaded document.addEventListener('DOMContentLoaded',()=>{window.ecoForums=new EcoForums();});