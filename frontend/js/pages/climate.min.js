class WeatherIntegration{constructor(){this.apiKey='YOUR_OPENWEATHERMAP_API_KEY';// Replace with actual API key this.weatherWidget=document.getElementById('weatherWidget');this.locationBtn=document.getElementById('allowLocationBtn');this.locationPermission=document.getElementById('locationPermission');this.init();}init(){// Check if geolocation is supported if('geolocation' in navigator){this.locationBtn.addEventListener('click',()=> this.requestLocation());this.checkLocationPermission();}else{this.showError('Geolocation is not supported by this browser');}}checkLocationPermission(){// Check if permission was already granted navigator.permissions.query({name: 'geolocation'}).then(result=>{if(result.state==='granted'){this.getLocation();}else if(result.state==='denied'){this.showLocationPermission();}else{this.showLocationPermission();}});}requestLocation(){this.locationBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Getting Location...';this.locationBtn.disabled=true;navigator.geolocation.getCurrentPosition(position=> this.getWeatherData(position.coords.latitude,position.coords.longitude),error=> this.handleLocationError(error),{enableHighAccuracy: true,timeout: 10000,maximumAge: 300000});}getLocation(){navigator.geolocation.getCurrentPosition(position=> this.getWeatherData(position.coords.latitude,position.coords.longitude),error=> this.handleLocationError(error));}async getWeatherData(lat,lon){try{this.showLoading();// OpenWeatherMap API call const response=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${this.apiKey}&units=metric`);if(!response.ok){throw new Error('Weather API request failed');}const data=await response.json();this.displayWeather(data);}catch(error){console.error('Weather API error:',error);this.showError('Unable to fetch weather data. Please check your API key and try again.');}}displayWeather(data){const{main,weather,wind,name,sys}=data;const weatherHTML=` <div class="weather-data"> <div class="weather-main"> <div class="weather-icon">${this.getWeatherIcon(weather[0].icon)}</div> <div class="weather-temp">${Math.round(main.temp)}°C</div> <div class="weather-description">${weather[0].description}</div> <div class="weather-location">${name},${sys.country}</div> </div> <div class="weather-details"> <div class="weather-detail"> <div class="weather-detail-label">Feels Like</div> <div class="weather-detail-value">${Math.round(main.feels_like)}°C</div> </div> <div class="weather-detail"> <div class="weather-detail-label">Humidity</div> <div class="weather-detail-value">${main.humidity}%</div> </div> <div class="weather-detail"> <div class="weather-detail-label">Wind Speed</div> <div class="weather-detail-value">${Math.round(wind.speed * 3.6)}km/h</div> </div> <div class="weather-detail"> <div class="weather-detail-label">Pressure</div> <div class="weather-detail-value">${main.pressure}hPa</div> </div> </div> </div> <div class="carbon-tips"> <h3>🌱 Climate Action Tips for Today</h3> <ul> ${this.getCarbonTips(weather[0].main,main.temp)}</ul> </div> `;this.weatherWidget.innerHTML=weatherHTML;}getWeatherIcon(iconCode){const iconMap={'01d': '☀️','01n': '🌙','02d': '⛅','02n': '☁️','03d': '☁️','03n': '☁️','04d': '☁️','04n': '☁️','09d': '🌧️','09n': '🌧️','10d': '🌦️','10n': '🌧️','11d': '⛈️','11n': '⛈️','13d': '❄️','13n': '❄️','50d': '🌫️','50n': '🌫️'};return iconMap[iconCode] || '🌤️';}getCarbonTips(weatherMain,temperature){const tips=[];// Weather-based tips switch(weatherMain.toLowerCase()){case 'clear': tips.push('Great day for solar energy! Consider installing solar panels or using solar-powered devices.');tips.push('Perfect weather for outdoor activities-try biking or walking instead of driving.');break;case 'clouds': tips.push('Cloudy days are ideal for energy-efficient indoor activities.');tips.push('Check your home insulation-cloudy weather highlights heat loss.');break;case 'rain': tips.push('Rainwater harvesting can reduce your water bill and conserve resources.');tips.push('Use this time to plan sustainable transportation options for drier days.');break;case 'snow': tips.push('Snow reflects sunlight-consider light-colored roofing for year-round energy savings.');tips.push('Bundle up instead of turning up the heat-every degree counts!');break;default: tips.push('Monitor your energy usage with smart devices to identify savings opportunities.');}// Temperature-based tips if(temperature > 30){tips.push('High temperatures increase AC usage-use fans and keep blinds closed during peak sun hours.');}else if(temperature < 10){tips.push('Cold weather spikes heating costs-improve insulation and use programmable thermostats.');}// General tips tips.push('Track your carbon footprint using our impact calculator to see your progress.');tips.push('Small changes add up-consider one eco-friendly action today!');return tips.map(tip=> `<li>${tip}</li>`).join('');}showLoading(){this.weatherWidget.innerHTML=` <div class="weather-loading"> <i class="fas fa-spinner fa-spin"></i> <p>Loading weather data...</p> </div> `;}showLocationPermission(){this.locationPermission.style.display='flex';this.weatherWidget.innerHTML=` <div class="weather-loading"> <i class="fas fa-map-marker-alt"></i> <p>Click "Allow Location Access" to see local weather and climate tips</p> </div> `;}handleLocationError(error){let message='Unable to get your location. ';switch(error.code){case error.PERMISSION_DENIED: message+='Location access denied. Please enable location permissions.';break;case error.POSITION_UNAVAILABLE: message+='Location information is unavailable.';break;case error.TIMEOUT: message+='Location request timed out.';break;default: message+='An unknown error occurred.';}this.showError(message);}showError(message){this.weatherWidget.innerHTML=` <div class="weather-error"> <i class="fas fa-exclamation-triangle"></i> <p>${message}</p> <p><small>Note: Make sure to add your OpenWeatherMap API key to the JavaScript file.</small></p> </div> `;}}// Initialize weather integration when DOM is loaded document.addEventListener('DOMContentLoaded',()=>{new WeatherIntegration();});