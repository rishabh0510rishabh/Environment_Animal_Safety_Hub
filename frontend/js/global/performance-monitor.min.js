class PerformanceMonitor{constructor(){this.metrics={coreWebVitals:{},resourceTiming: [],navigationTiming:{},longTasks: [],memoryUsage:{},cacheStats:{}};this.slowResourceThreshold=1000;// 1 second this.init();}init(){this.trackCoreWebVitals();this.trackResourceLoading();this.trackNavigationTiming();this.trackLongTasks();this.trackMemoryUsage();this.setupPerformanceObserver();this.setupVisibilityChangeTracking();}trackCoreWebVitals(){if('PerformanceObserver' in window){try{// Largest Contentful Paint(LCP)-Enhanced const lcpObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];this.metrics.coreWebVitals.lcp={value: lastEntry.startTime,element: lastEntry.element?.tagName || 'unknown',url: lastEntry.url || 'unknown',timestamp: Date.now()};this.reportMetric('LCP',lastEntry.startTime,{element: lastEntry.element?.tagName,rating: this.getVitalsRating('lcp',lastEntry.startTime)});});lcpObserver.observe({entryTypes: ['largest-contentful-paint']});// First Input Delay(FID)-Enhanced const fidObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{const fidValue=entry.processingStart-entry.startTime;this.metrics.coreWebVitals.fid={value: fidValue,eventType: entry.name,timestamp: Date.now()};this.reportMetric('FID',fidValue,{eventType: entry.name,rating: this.getVitalsRating('fid',fidValue)});});});fidObserver.observe({entryTypes: ['first-input']});// Cumulative Layout Shift(CLS)-Enhanced let clsValue=0;let clsEntries=[];const clsObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{if(!entry.hadRecentInput){clsValue+=entry.value;clsEntries.push({value: entry.value,timestamp: entry.startTime,sources: entry.sources || []});}});this.metrics.coreWebVitals.cls={value: clsValue,entries: clsEntries,timestamp: Date.now()};this.reportMetric('CLS',clsValue,{rating: this.getVitalsRating('cls',clsValue),shifts: clsEntries.length});});clsObserver.observe({entryTypes: ['layout-shift']});// First Contentful Paint(FCP)const fcpObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];this.metrics.coreWebVitals.fcp={value: lastEntry.startTime,timestamp: Date.now()};this.reportMetric('FCP',lastEntry.startTime,{rating: this.getVitalsRating('fcp',lastEntry.startTime)});});fcpObserver.observe({entryTypes: ['paint']});// Time to First Byte(TTFB)const navigationObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{if(entry.entryType==='navigation'){const ttfb=entry.responseStart-entry.requestStart;this.metrics.coreWebVitals.ttfb={value: ttfb,timestamp: Date.now()};this.reportMetric('TTFB',ttfb,{rating: this.getVitalsRating('ttfb',ttfb)});}});});navigationObserver.observe({entryTypes: ['navigation']});}catch(error){console.warn('Performance Observer not fully supported:',error);}}}getVitalsRating(metric,value){const thresholds={lcp:{good: 2500,poor: 4000},fid:{good: 100,poor: 300},cls:{good: 0.1,poor: 0.25},fcp:{good: 1800,poor: 3000},ttfb:{good: 800,poor: 1800}};const threshold=thresholds[metric];if(!threshold)return 'unknown';if(value <=threshold.good)return 'good';if(value <=threshold.poor)return 'needs-improvement';return 'poor';}trackResourceLoading(){if('PerformanceObserver' in window){const resourceObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{const resourceData={name: entry.name,duration: entry.duration,size: entry.transferSize || 0,type: this.getResourceType(entry.name),timestamp: Date.now(),initiatorType: entry.initiatorType || 'unknown'};this.metrics.resourceTiming.push(resourceData);// Log slow resources with more detail if(entry.duration > this.slowResourceThreshold){console.warn(`🐌 Slow resource(${entry.duration.toFixed(2)}ms):`,{url: entry.name,size: this.formatBytes(entry.transferSize),type: resourceData.type,initiator: entry.initiatorType});}});});resourceObserver.observe({entryTypes: ['resource']});}}getResourceType(url){if(url.includes('.css'))return 'stylesheet';if(url.includes('.js'))return 'script';if(/\.(png|jpg|jpeg|gif|webp|avif|svg)/.test(url))return 'image';if(/\.(woff2?|ttf|eot)/.test(url))return 'font';if(url.includes('/api/'))return 'api';return 'other';}formatBytes(bytes){if(bytes===0)return '0 B';const k=1024;const sizes=['B','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/ Math.log(k));return parseFloat((bytes / Math.pow(k,i)).toFixed(2))+' '+sizes[i];}trackNavigationTiming(){window.addEventListener('load',()=>{setTimeout(()=>{const navigation=performance.getEntriesByType('navigation')[0];if(navigation){this.metrics.navigationTiming={domContentLoaded: navigation.domContentLoadedEventEnd-navigation.domContentLoadedEventStart,loadComplete: navigation.loadEventEnd-navigation.loadEventStart,totalTime: navigation.loadEventEnd-navigation.fetchStart,dnsLookup: navigation.domainLookupEnd-navigation.domainLookupStart,tcpConnect: navigation.connectEnd-navigation.connectStart,serverResponse: navigation.responseEnd-navigation.requestStart,domInteractive: navigation.domInteractive-navigation.fetchStart,domComplete: navigation.domComplete-navigation.fetchStart,timestamp: Date.now()};this.reportMetric('Total Load Time',this.metrics.navigationTiming.totalTime);this.reportMetric('DNS Lookup',this.metrics.navigationTiming.dnsLookup);this.reportMetric('TCP Connect',this.metrics.navigationTiming.tcpConnect);this.reportMetric('Server Response',this.metrics.navigationTiming.serverResponse);}},0);});}trackLongTasks(){if('PerformanceObserver' in window){const longTaskObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{const taskData={duration: entry.duration,startTime: entry.startTime,timestamp: Date.now()};this.metrics.longTasks.push(taskData);if(entry.duration > 50){console.warn(`⏰ Long task blocked main thread: ${entry.duration.toFixed(2)}ms`);}});});longTaskObserver.observe({entryTypes: ['longtask']});}}trackMemoryUsage(){if('memory' in performance){setInterval(()=>{const memory=performance.memory;this.metrics.memoryUsage={used: memory.usedJSHeapSize,total: memory.totalJSHeapSize,limit: memory.jsHeapSizeLimit,timestamp: Date.now()};},5000);// Update every 5 seconds}}setupVisibilityChangeTracking(){document.addEventListener('visibilitychange',()=>{const state=document.visibilityState;const timestamp=Date.now();console.log(`👁️ Page visibility changed to: ${state}at ${new Date(timestamp).toLocaleTimeString()}`);// Could track performance differences between background/foreground if(state==='visible'){// Page became visible again this.reportMetric('Page Visible',0,{timestamp});}});}setupPerformanceObserver(){// Additional observers can be added here}reportMetric(name,value,details={}){const formattedValue=typeof value==='number' ? value.toFixed(2): value;const rating=details.rating || 'unknown';console.log(`📊 ${name}: ${formattedValue}ms`,{rating,...details,timestamp: new Date().toISOString()});// Send to analytics if available if(window.gtag){window.gtag('event','performance_metric',{metric_name: name,metric_value: value,metric_rating: rating,...details});}}getMetrics(){return{...this.metrics};}assessPerformance(){const vitals=this.metrics.coreWebVitals;const assessment={lcp: this.getVitalsRating('lcp',vitals.lcp?.value),fid: this.getVitalsRating('fid',vitals.fid?.value),cls: this.getVitalsRating('cls',vitals.cls?.value),fcp: this.getVitalsRating('fcp',vitals.fcp?.value),ttfb: this.getVitalsRating('ttfb',vitals.ttfb?.value),totalLoadTime: this.getVitalsRating('totalLoadTime',this.metrics.navigationTiming.totalTime),slowResources: this.metrics.resourceTiming.filter(r=> r.duration > this.slowResourceThreshold).length,longTasks: this.metrics.longTasks.filter(t=> t.duration > 50).length};console.table(assessment);// Provide recommendations this.provideRecommendations(assessment);return assessment;}provideRecommendations(assessment){const recommendations=[];if(assessment.lcp==='poor')recommendations.push('Optimize Largest Contentful Paint-consider lazy loading images above the fold');if(assessment.fid==='poor')recommendations.push('Reduce First Input Delay-minimize long tasks and JavaScript execution');if(assessment.cls==='poor')recommendations.push('Fix Cumulative Layout Shift-reserve space for dynamic content');if(assessment.ttfb==='poor')recommendations.push('Improve Time to First Byte-optimize server response time');if(assessment.slowResources > 5)recommendations.push(`Optimize ${assessment.slowResources}slow-loading resources`);if(assessment.longTasks > 3)recommendations.push(`Reduce ${assessment.longTasks}long tasks blocking the main thread`);if(recommendations.length > 0){console.log('💡 Performance Recommendations:');recommendations.forEach((rec,index)=> console.log(` ${index+1}. ${rec}`));}else{console.log('✅ Performance looks good! All metrics are within acceptable ranges.');}}exportMetrics(){const exportData={timestamp: new Date().toISOString(),url: window.location.href,userAgent: navigator.userAgent,...this.metrics};console.log('📤 Performance Data Export:',exportData);return exportData;}}// Initialize enhanced performance monitoring const performanceMonitor=new PerformanceMonitor();// Make available globally window.PerformanceMonitor=PerformanceMonitor;window.performanceMonitor=performanceMonitor;